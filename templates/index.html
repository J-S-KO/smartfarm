<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartFarm - 대시보드</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.30.0/index.min.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <h1>🌱 SmartFarm 대시보드</h1>
            <div class="nav-actions">
                <span id="last-update" class="update-time">업데이트 중...</span>
                <a href="{{ url_for('logout') }}" class="btn btn-secondary">로그아웃</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- 현재 상태 카드 -->
        <section class="current-status">
            <h2>현재 상태</h2>
            <div class="status-grid" id="status-grid">
                <div class="status-card">
                    <div class="status-label">온도 (°C)</div>
                    <div class="status-value" id="temp-value">-</div>
                </div>
                <div class="status-card">
                    <div class="status-label">습도 (%)</div>
                    <div class="status-value" id="hum-value">-</div>
                </div>
                <div class="status-card">
                    <div class="status-label">토양습도 (%)</div>
                    <div class="status-value" id="soil-value">-</div>
                </div>
                <div class="status-card">
                    <div class="status-label">조도 (Lux)</div>
                    <div class="status-value" id="lux-value">-</div>
                </div>
                <div class="status-card">
                    <div class="status-label">VPD (kPa)</div>
                    <div class="status-value" id="vpd-value">-</div>
                </div>
                <div class="status-card">
                    <div class="status-label">DLI (mol/m²/day)</div>
                    <div class="status-value" id="dli-value">-</div>
                </div>
            </div>
            
            <!-- 구동계 상태 -->
            <h3 style="margin-top: 16px; margin-bottom: 10px; font-size: 1.1em; color: var(--text-primary); font-weight: 600;">구동계 상태</h3>
            <div class="actuator-grid" id="actuator-grid">
                <div class="actuator-card" id="led-w-card">
                    <div class="actuator-icon">💡</div>
                    <div class="actuator-label">LED (White)</div>
                    <div class="actuator-status" id="led-w-status">-</div>
                    <button class="actuator-toggle-btn" id="led-w-toggle-btn" title="LED White ON/OFF 토글">토글</button>
                </div>
                <div class="actuator-card" id="led-p-card">
                    <div class="actuator-icon">💜</div>
                    <div class="actuator-label">LED (Purple)</div>
                    <div class="actuator-status" id="led-p-status">-</div>
                    <button class="actuator-toggle-btn" id="led-p-toggle-btn" title="LED Purple ON/OFF 토글">토글</button>
                </div>
                <div class="actuator-card" id="curtain-card">
                    <div class="actuator-icon">🪟</div>
                    <div class="actuator-label">커튼</div>
                    <div class="actuator-status" id="curtain-status">-</div>
                    <button class="actuator-toggle-btn" id="curtain-toggle-btn" title="커튼 열기/닫기 토글">토글</button>
                </div>
                <div class="actuator-card" id="valve-card">
                    <div class="actuator-icon">💧</div>
                    <div class="actuator-label">밸브</div>
                    <div class="actuator-status" id="valve-status">-</div>
                    <button class="actuator-toggle-btn" id="valve-toggle-btn" title="밸브 ON/OFF 토글">토글</button>
                </div>
                <div class="actuator-card" id="fan-card">
                    <div class="actuator-icon">🌬️</div>
                    <div class="actuator-label">팬</div>
                    <div class="actuator-status" id="fan-status">-</div>
                    <button class="actuator-toggle-btn" id="fan-toggle-btn" title="팬 ON/OFF 토글">토글</button>
                </div>
                <div class="actuator-card" id="emergency-card">
                    <div class="actuator-icon">🛑</div>
                    <div class="actuator-label">비상정지</div>
                    <div class="actuator-status" id="emergency-status">-</div>
                </div>
            </div>
        </section>

        <!-- 이미지 표시 섹션 -->
        <section class="image-section">
            <h2>현장 사진</h2>
            <div class="image-controls">
                <div class="image-selector-group">
                    <label for="image-date">날짜:</label>
                    <input type="date" id="image-date" class="date-input">
                </div>
                <div class="image-selector-group">
                    <label for="image-time">시간:</label>
                    <select id="image-time" class="time-select">
                        <option value="">최신 사진</option>
                    </select>
                </div>
                <button id="load-image-btn" class="btn btn-primary">사진 로드</button>
                <button id="capture-current-btn" class="btn btn-primary">실시간 촬영</button>
            </div>
            <div class="image-container">
                <img id="current-image" src="" alt="현장 사진" style="max-width: 100%; border-radius: 8px; display: none;">
                <div id="image-placeholder" class="image-placeholder">사진을 선택하세요</div>
            </div>
        </section>

        <!-- 그래프 영역 -->
        <section class="charts-section">
            <h2>데이터 시각화</h2>
            <div class="quick-time-buttons">
                <button class="btn btn-time" data-hours="1">최근 1시간</button>
                <button class="btn btn-time" data-hours="3">최근 3시간</button>
                <button class="btn btn-time" data-hours="6">최근 6시간</button>
                <button class="btn btn-time" data-hours="12">최근 12시간</button>
                <button class="btn btn-time" data-hours="24">최근 24시간</button>
                <button class="btn btn-time" id="btn-3days">최근 3일</button>
            </div>
            <div id="loading-indicator" class="loading-indicator" style="display: none;">
                <span>데이터 로딩 중...</span>
            </div>
            <div class="chart-container">
                <canvas id="main-chart"></canvas>
            </div>
            <!-- 비교 모드 시리즈 선택 영역 -->
            <div id="compare-series-selector" class="compare-series-selector" style="display: none;">
                <h3>데이터 선택</h3>
                <div class="series-buttons">
                    <button class="btn-series" data-series="Temp_C">온도</button>
                    <button class="btn-series" data-series="Hum_Pct">습도</button>
                    <button class="btn-series" data-series="Soil_Pct">토양습도</button>
                    <button class="btn-series" data-series="VPD_kPa">VPD</button>
                    <button class="btn-series" data-series="DLI_mol">DLI</button>
                    <button class="btn-series" data-series="Lux">조도</button>
                </div>
                <div class="date-legend">
                    <h4>날짜 범례</h4>
                    <div class="legend-items">
                        <div class="legend-item">
                            <span class="legend-color" style="background-color: rgb(33, 150, 243);"></span>
                            <span class="legend-label">오늘</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background-color: rgb(76, 175, 80);"></span>
                            <span class="legend-label">D-1</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background-color: rgb(255, 152, 0);"></span>
                            <span class="legend-label">D-2</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 상태 알림 및 액션 -->
        <section class="alerts-section">
            <div class="alerts-header">
                <h2>상태 분석 및 권장 사항</h2>
                <button id="help-btn" class="help-btn" title="경고 케이스 도움말">?</button>
            </div>
            <div id="alerts-container">
                <!-- 동적으로 생성 -->
            </div>
        </section>

        <!-- Help 모달 -->
        <div id="help-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>경고 케이스 도움말</h2>
                    <span class="modal-close">&times;</span>
                </div>
                <div class="modal-body">
                    <p>다음은 시스템에서 감지할 수 있는 모든 경고 케이스 목록입니다.</p>
                    <div id="help-cases-list">
                        <!-- 동적으로 생성 -->
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>

