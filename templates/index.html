<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartFarm - 대시보드</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.30.0/index.min.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <h1>🌱 SmartFarm 대시보드</h1>
            <div class="nav-actions">
                <span id="last-update" class="update-time">업데이트 중...</span>
                <a href="{{ url_for('logout') }}" class="btn btn-secondary">로그아웃</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- 현재 상태 카드 -->
        <section class="current-status">
            <h2>현재 상태</h2>
            <div class="status-grid" id="status-grid">
                <div class="status-card">
                    <div class="status-label">온도 (°C)</div>
                    <div class="status-value" id="temp-value">-</div>
                </div>
                <div class="status-card">
                    <div class="status-label">습도 (%)</div>
                    <div class="status-value" id="hum-value">-</div>
                </div>
                <div class="status-card">
                    <div class="status-label">토양습도 (%)</div>
                    <div class="status-value" id="soil-value">-</div>
                </div>
                <div class="status-card">
                    <div class="status-label">조도 (Lux)</div>
                    <div class="status-value" id="lux-value">-</div>
                </div>
                <div class="status-card">
                    <div class="status-label">VPD (kPa)</div>
                    <div class="status-value" id="vpd-value">-</div>
                </div>
                <div class="status-card">
                    <div class="status-label">DLI (mol/m²/day)</div>
                    <div class="status-value" id="dli-value">-</div>
                </div>
            </div>
            
            <!-- 구동계 상태 -->
            <h3 style="margin-top: 16px; margin-bottom: 10px; font-size: 1.1em; color: var(--text-primary); font-weight: 600;">구동계 상태</h3>
            <div class="actuator-grid" id="actuator-grid">
                <div class="actuator-card" id="led-w-card">
                    <div class="actuator-icon">💡</div>
                    <div class="actuator-label">LED (White)</div>
                    <div class="actuator-status" id="led-w-status">-</div>
                </div>
                <div class="actuator-card" id="led-p-card">
                    <div class="actuator-icon">💜</div>
                    <div class="actuator-label">LED (Purple)</div>
                    <div class="actuator-status" id="led-p-status">-</div>
                </div>
                <div class="actuator-card" id="curtain-card">
                    <div class="actuator-icon">🪟</div>
                    <div class="actuator-label">커튼</div>
                    <div class="actuator-status" id="curtain-status">-</div>
                </div>
                <div class="actuator-card" id="valve-card">
                    <div class="actuator-icon">💧</div>
                    <div class="actuator-label">밸브</div>
                    <div class="actuator-status" id="valve-status">-</div>
                </div>
                <div class="actuator-card" id="fan-card">
                    <div class="actuator-icon">🌬️</div>
                    <div class="actuator-label">팬</div>
                    <div class="actuator-status" id="fan-status">-</div>
                </div>
                <div class="actuator-card" id="emergency-card">
                    <div class="actuator-icon">🛑</div>
                    <div class="actuator-label">비상정지</div>
                    <div class="actuator-status" id="emergency-status">-</div>
                </div>
            </div>
        </section>

        <!-- 이미지 표시 섹션 -->
        <section class="image-section">
            <h2>현장 사진</h2>
            <div class="image-controls">
                <div class="image-selector-group">
                    <label for="image-date">날짜:</label>
                    <input type="date" id="image-date" class="date-input">
                </div>
                <div class="image-selector-group">
                    <label for="image-time">시간:</label>
                    <select id="image-time" class="time-select">
                        <option value="">최신 사진</option>
                    </select>
                </div>
                <button id="load-image-btn" class="btn btn-primary">사진 로드</button>
            </div>
            <div class="image-container">
                <img id="current-image" src="" alt="현장 사진" style="max-width: 100%; border-radius: 8px; display: none;">
                <div id="image-placeholder" class="image-placeholder">사진을 선택하세요</div>
            </div>
        </section>

        <!-- 날짜 범위 선택 -->
        <section class="date-range-section">
            <h2>데이터 범위 선택</h2>
            <div class="date-controls">
                <div class="date-input-group">
                    <label for="start-date">시작 날짜</label>
                    <input type="date" id="start-date" class="date-input">
                </div>
                <div class="date-input-group">
                    <label for="end-date">종료 날짜</label>
                    <input type="date" id="end-date" class="date-input">
                </div>
                <div class="date-buttons-row">
                    <button id="load-data-btn" class="btn btn-primary">데이터 로드</button>
                    <button id="reset-date-btn" class="btn btn-secondary">초기화</button>
                </div>
            </div>
        </section>

        <!-- 그래프 영역 -->
        <section class="charts-section">
            <h2>데이터 시각화</h2>
            
            <!-- 계열 선택 체크박스 -->
            <div class="series-selector">
                <h3>표시할 데이터 선택</h3>
                <div class="checkbox-group" id="series-checkboxes">
                    <!-- 동적으로 생성 -->
                </div>
                <button id="apply-series-btn" class="btn btn-primary" style="margin-top: 12px;">적용</button>
            </div>
            
            <!-- 시간 범위 조정 (X축) -->
            <div class="time-range-controls">
                <h3>시간 범위 조정 (X축)</h3>
                <div class="slider-control-group">
                    <div class="time-inputs-row">
                        <div class="slider-label-group">
                            <label for="time-start">시작 시간:</label>
                            <input type="time" id="time-start" class="time-input">
                        </div>
                        <div class="slider-label-group">
                            <label for="time-end">종료 시간:</label>
                            <input type="time" id="time-end" class="time-input">
                        </div>
                        <button id="apply-time-btn" class="btn btn-small">적용</button>
                    </div>
                    <div class="slider-container">
                        <div class="dual-range-container">
                            <div class="range-track"></div>
                            <input type="range" id="time-range-start" class="range-slider range-start" min="0" max="100" value="0">
                            <input type="range" id="time-range-end" class="range-slider range-end" min="0" max="100" value="100">
                        </div>
                        <div class="slider-labels">
                            <span id="time-range-min">00:00</span>
                            <span id="time-range-max">23:59</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Y축 스케일 조정 -->
            <div class="scale-controls">
                <h3>Y축 범위 설정</h3>
                <div class="scale-control-group">
                    <label>
                        <input type="checkbox" id="auto-scale" checked> 자동 스케일
                    </label>
                    <div id="manual-scale-inputs" style="display: none; margin-top: 12px;">
                        <div class="slider-control-group">
                            <div class="slider-label-group">
                                <label for="y-min">최소값:</label>
                                <input type="number" id="y-min" placeholder="최소값" step="0.1" class="number-input">
                            </div>
                            <div class="slider-container">
                                <input type="range" id="y-min-slider" class="range-slider" min="0" max="100" value="0">
                                <span id="y-min-value">0</span>
                            </div>
                        </div>
                        <div class="slider-control-group" style="margin-top: 12px;">
                            <div class="slider-label-group">
                                <label for="y-max">최대값:</label>
                                <input type="number" id="y-max" placeholder="최대값" step="0.1" class="number-input">
                            </div>
                            <div class="slider-container">
                                <input type="range" id="y-max-slider" class="range-slider" min="0" max="100" value="100">
                                <span id="y-max-value">100</span>
                            </div>
                        </div>
                        <button id="apply-scale-btn" class="btn btn-small" style="margin-top: 12px;">적용</button>
                    </div>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="main-chart"></canvas>
            </div>
        </section>

        <!-- 상태 알림 및 액션 -->
        <section class="alerts-section">
            <div class="alerts-header">
                <h2>상태 분석 및 권장 사항</h2>
                <button id="help-btn" class="help-btn" title="경고 케이스 도움말">?</button>
            </div>
            <div id="alerts-container">
                <!-- 동적으로 생성 -->
            </div>
        </section>

        <!-- Help 모달 -->
        <div id="help-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>경고 케이스 도움말</h2>
                    <span class="modal-close">&times;</span>
                </div>
                <div class="modal-body">
                    <p>다음은 시스템에서 감지할 수 있는 모든 경고 케이스 목록입니다.</p>
                    <div id="help-cases-list">
                        <!-- 동적으로 생성 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>

