# LED í† ê¸€ ë° ì‹œë¦¬ì–¼ í¬íŠ¸ ì¶©ëŒ í•´ê²° ê¸°ë¡

**ìž‘ì„±ì¼**: 2026-01-10  
**ìž‘ì„±ìž**: Cursor AI  
**ì£¼ì œ**: ì›¹ UI LED í† ê¸€ ê¸°ëŠ¥ ë¯¸ìž‘ë™ ë¬¸ì œ ë° ì‹œë¦¬ì–¼ í¬íŠ¸ ì¶©ëŒ í•´ê²°

---

## ðŸ“‹ ë¬¸ì œ ì •ì˜

### í•µì‹¬ ë¬¸ì œ
ì›¹ UIì—ì„œ LED í† ê¸€ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ UIìƒìœ¼ë¡œëŠ” ON/OFF ìƒíƒœê°€ ë³€ê²½ë˜ì§€ë§Œ, ì‹¤ì œë¡œëŠ” ë¬¼ë¦¬ì  LEDê°€ ë™ìž‘í•˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

### ì¦ìƒ
1. **UI ìƒíƒœ ë¶ˆì¼ì¹˜**: ì›¹ UIì—ì„œëŠ” LEDê°€ ONìœ¼ë¡œ í‘œì‹œë˜ì§€ë§Œ ì‹¤ì œ LEDëŠ” êº¼ì ¸ ìžˆìŒ
2. **ì–‘ë°©í–¥ í†µì‹  ì‹¤íŒ¨**: ì›¹ UIì—ì„œ í† ê¸€í•´ë„ Arduinoì— ëª…ë ¹ì´ ì „ë‹¬ë˜ì§€ ì•ŠìŒ
3. **ìžë™ ì œì–´ëŠ” ì •ìƒ**: ì˜¤ì „/ì˜¤í›„ ìžë™ ì ë“±/ì†Œë“± ê¸°ëŠ¥ì€ ì •ìƒ ìž‘ë™
4. **ì‹œë¦¬ì–¼ í¬íŠ¸ ì¶©ëŒ**: `main.py`ì™€ `web_server.py`ê°€ ë™ì‹œì— ê°™ì€ ì‹œë¦¬ì–¼ í¬íŠ¸(`/dev/ttyACM0`)ë¥¼ ì—´ë ¤ê³  ì‹œë„

### ë¬¸ì œ ë°œìƒ ì‹œì 
Arduino ë²„íŠ¼ìœ¼ë¡œ ìˆ˜ë™ ì œì–´ ì‹œ fade ê¸°ëŠ¥ì´ ë¶ˆí•„ìš”í•˜ê²Œ ì ìš©ë˜ì–´ ìžˆì—ˆê³ , ì´ë¥¼ ë‹¨ìˆœ ì¼œê³  ë„ëŠ” ê²ƒê³¼ fade ê¸°ëŠ¥ì„ ë¶„ë¦¬í•œ ì´í›„ë¶€í„° ë°œìƒí–ˆìŠµë‹ˆë‹¤. fade ê¸°ëŠ¥ì€ ì˜¤ë¡œì§€ ì˜¤ì „ì— ìžë™ìœ¼ë¡œ ì¼œì§€ê³  ì˜¤í›„ì— ìžë™ìœ¼ë¡œ êº¼ì§ˆ ë•Œë§Œ ë°˜ì˜í•˜ë„ë¡ ë³€ê²½í•œ ì§í›„ ë¬¸ì œê°€ ì‹œìž‘ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## ðŸ”µ ì›ì¸ ë¶„ì„

### 1. ì‹œë¦¬ì–¼ í¬íŠ¸ ì¶©ëŒ (ì£¼ìš” ì›ì¸)

#### ë¬¸ì œ ìƒí™©
- `main.py`: `smartfarm.service`ë¡œ ì‹¤í–‰ ì¤‘, `ser_b` ì‹œë¦¬ì–¼ í¬íŠ¸ ì‚¬ìš©
- `web_server.py`: `smartfarm-web.service`ë¡œ ë³„ë„ ì‹¤í–‰ ì¤‘, ë™ì¼í•œ `ser_b` ì‹œë¦¬ì–¼ í¬íŠ¸ ì‚¬ìš© ì‹œë„
- **ê²°ê³¼**: ë‘ í”„ë¡œì„¸ìŠ¤ê°€ ë™ì¼í•œ ì‹œë¦¬ì–¼ í¬íŠ¸ë¥¼ ë™ì‹œì— ì—´ë ¤ê³  í•˜ì—¬ ì¶©ëŒ ë°œìƒ

#### ì¦ê±°
```bash
# systemd ì„œë¹„ìŠ¤ í™•ì¸
sudo systemctl status smartfarm-web
# smartfarm-web.serviceê°€ ì‹¤í–‰ ì¤‘ì´ì—ˆìŒ

# ì‹œë¦¬ì–¼ í¬íŠ¸ ì‚¬ìš© í™•ì¸
lsof /dev/ttyACM0
# ë‘ í”„ë¡œì„¸ìŠ¤ê°€ ë™ì‹œì— í¬íŠ¸ë¥¼ ì‚¬ìš©í•˜ë ¤ê³  ì‹œë„
```

### 2. Arduino ì½”ë“œ ìƒíƒœ ê´€ë¦¬ ë¶ˆì¼ì¹˜

#### ë¬¸ì œ ì½”ë“œ (board_b.ino)
```cpp
void setLedBrightnessImmediate(int level) {
  stopLedFade(); // íŽ˜ì´ë“œ ì¤‘ë‹¨
  ledBrightnessLevel = level;
  if (level >= 0 && level <= 3) {
    int targetBrightness = LED_BRIGHTNESS_VALUES[level];
    analogWrite(PIN_LED_W, targetBrightness);
    // ë¬¸ì œ: ledFadeCurrentBrightnessë¥¼ ì—…ë°ì´íŠ¸í•˜ì§€ ì•ŠìŒ
  }
}

void updateLedFade() {
  if (ledFadeActive) {
    // ledFadeCurrentBrightnessê°€ ì´ì „ ê°’ìœ¼ë¡œ ë‚¨ì•„ìžˆì–´
    // ì¦‰ì‹œ ì„¤ì •í•œ ë°ê¸°ë¥¼ ë®ì–´ì”€
    analogWrite(PIN_LED_W, ledFadeCurrentBrightness);
  }
}
```

#### ë¬¸ì œì 
- `setLedBrightnessImmediate()`ì—ì„œ `ledFadeCurrentBrightness`ë¥¼ ì—…ë°ì´íŠ¸í•˜ì§€ ì•ŠìŒ
- `updateLedFade()`ê°€ ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ë©´ì„œ ì´ì „ íŽ˜ì´ë“œ ë°ê¸° ê°’ìœ¼ë¡œ ë®ì–´ì”€
- ê²°ê³¼ì ìœ¼ë¡œ ì¦‰ì‹œ ì„¤ì •í•œ ë°ê¸°ê°€ ë¬´ì‹œë¨

### 3. ì›¹ ì„œë²„ ì´ˆê¸°í™” ë¬¸ì œ

#### ë¬¸ì œ ì½”ë“œ (web_server.py)
```python
def init_web_server(state_dict, serial_b, serial_b_lock, state_lock_obj, cam_thread=None):
    global sys_state, ser_b, ser_b_lock, state_lock, camera_thread
    sys_state = state_dict
    ser_b = serial_b
    ser_b_lock = serial_b_lock  # ì¤‘ìš”: ì‹œë¦¬ì–¼ í¬íŠ¸ ë½ ê³µìœ 
    state_lock = state_lock_obj
    camera_thread = cam_thread
```

#### ë¬¸ì œì 
- `web_server.py`ê°€ ë…ë¦½ ì‹¤í–‰ ì‹œ `ser_b`ë¥¼ ìƒˆë¡œ ìƒì„±í•˜ë ¤ê³  ì‹œë„
- `main.py`ì—ì„œ ì´ë¯¸ `ser_b`ë¥¼ ì‚¬ìš© ì¤‘ì´ë©´ ì¶©ëŒ ë°œìƒ
- `ser_b_lock`ì´ ì œëŒ€ë¡œ ê³µìœ ë˜ì§€ ì•Šì„ ìˆ˜ ìžˆìŒ

---

## ðŸŸ¢ í•´ê²° ë°©ë²•

### 1. ì›¹ ì„œë²„ë¥¼ main.py ìŠ¤ë ˆë“œë¡œ í†µí•© (ìµœì¢… í•´ê²°)

#### ë³€ê²½ ì‚¬í•­ (main.py)
```python
# ê¸°ì¡´: web_server.pyë¥¼ ë³„ë„ ì„œë¹„ìŠ¤ë¡œ ì‹¤í–‰
# ë¬¸ì œ: ì‹œë¦¬ì–¼ í¬íŠ¸ ì¶©ëŒ ë°œìƒ

# í•´ê²°: main.pyì—ì„œ ì›¹ ì„œë²„ë¥¼ ìŠ¤ë ˆë“œë¡œ ì‹¤í–‰
def main():
    # ... (ì‹œë¦¬ì–¼ í¬íŠ¸ ì´ˆê¸°í™”) ...
    
    # ì›¹ ì„œë²„ ì´ˆê¸°í™” ë° ì‹¤í–‰
    try:
        import web_server
        web_server.init_web_server(sys_state, ser_b, ser_b_lock, state_lock, t_cam)
        app_logger.info("[Main] ì›¹ ì„œë²„ ì´ˆê¸°í™” ì™„ë£Œ (êµ¬ë™ê³„ ì œì–´ í™œì„±í™”)")
        
        # ì›¹ ì„œë²„ë¥¼ ë³„ë„ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ (main.pyì™€ í•¨ê»˜ ì‹¤í–‰)
        def run_web_server():
            web_server.app.run(host='0.0.0.0', port=5000, debug=False, use_reloader=False)
        
        t_web = threading.Thread(target=run_web_server, daemon=True)
        t_web.start()
        threads.append(t_web)
        app_logger.info("[Main] ì›¹ ì„œë²„ ìŠ¤ë ˆë“œ ì‹œìž‘ (í¬íŠ¸ 5000)")
    except Exception as e:
        app_logger.warning(f"[Main] ì›¹ ì„œë²„ ì´ˆê¸°í™” ì‹¤íŒ¨: {e}")
```

#### íš¨ê³¼
- âœ… `ser_b`ì™€ `ser_b_lock`ì„ `main.py`ì™€ `web_server.py`ê°€ ê³µìœ 
- âœ… ì‹œë¦¬ì–¼ í¬íŠ¸ ì¶©ëŒ ì™„ì „ í•´ê²°
- âœ… ë‹¨ì¼ í”„ë¡œì„¸ìŠ¤ì—ì„œ ëª¨ë“  ê¸°ëŠ¥ í†µí•© ê´€ë¦¬

### 2. Arduino LED ìƒíƒœ ê´€ë¦¬ ìˆ˜ì •

#### ìˆ˜ì • ì½”ë“œ (board_b.ino)
```cpp
void setLedBrightnessImmediate(int level) {
  stopLedFade(); // íŽ˜ì´ë“œ ì¤‘ë‹¨
  ledBrightnessLevel = level;
  if (level >= 0 && level <= 3) {
    int targetBrightness = LED_BRIGHTNESS_VALUES[level];
    analogWrite(PIN_LED_W, targetBrightness);
    ledFadeCurrentBrightness = targetBrightness; // âœ… ì¶”ê°€: ì¦‰ì‹œ ë°ê¸° ì„¤ì • ì‹œ í˜„ìž¬ íŽ˜ì´ë“œ ë°ê¸°ë„ ì—…ë°ì´íŠ¸
  }
}

void stopLedFade() {
  if (ledFadeActive) {
    ledFadeActive = false;
    // âœ… ì¶”ê°€: íŽ˜ì´ë“œ ì¤‘ë‹¨ ì‹œ í˜„ìž¬ ë°ê¸°ë¥¼ ledBrightnessLevelì— í•´ë‹¹í•˜ëŠ” ê°’ìœ¼ë¡œ ì„¤ì •
    analogWrite(PIN_LED_W, LED_BRIGHTNESS_VALUES[ledBrightnessLevel]);
    ledFadeCurrentBrightness = LED_BRIGHTNESS_VALUES[ledBrightnessLevel]; // âœ… í˜„ìž¬ ë°ê¸° ì—…ë°ì´íŠ¸
  }
}
```

#### íš¨ê³¼
- âœ… ì¦‰ì‹œ ì„¤ì •í•œ ë°ê¸°ê°€ `updateLedFade()`ì— ì˜í•´ ë®ì–´ì“°ì´ì§€ ì•ŠìŒ
- âœ… íŽ˜ì´ë“œ ê¸°ëŠ¥ê³¼ ì¦‰ì‹œ ì œì–´ ê¸°ëŠ¥ì´ ë…ë¦½ì ìœ¼ë¡œ ìž‘ë™
- âœ… ìˆ˜ë™ ì œì–´ ì‹œ ì˜ë„í•œ ë°ê¸°ê°€ ì •í™•ížˆ ì ìš©ë¨

### 3. smartfarm-web.service ì œê±°

#### ì‹¤í–‰ ëª…ë ¹
```bash
# ì„œë¹„ìŠ¤ ì¤‘ì§€ ë° ë¹„í™œì„±í™”
sudo systemctl stop smartfarm-web
sudo systemctl disable smartfarm-web

# ì„œë¹„ìŠ¤ íŒŒì¼ ì‚­ì œ
sudo rm /etc/systemd/system/smartfarm-web.service

# systemd ë°ëª¬ ë¦¬ë¡œë“œ
sudo systemctl daemon-reload
```

#### íš¨ê³¼
- âœ… ì‹œë¦¬ì–¼ í¬íŠ¸ ì¶©ëŒ ì›ì¸ ì œê±°
- âœ… ë‹¨ì¼ ì„œë¹„ìŠ¤(`smartfarm.service`)ë¡œ ëª¨ë“  ê¸°ëŠ¥ ê´€ë¦¬
- âœ… ì‹œìŠ¤í…œ êµ¬ì¡° ë‹¨ìˆœí™”

### 4. send_cmd í•¨ìˆ˜ í†µí•© ë° ê°œì„ 

#### ë³€ê²½ ì‚¬í•­ (web_server.py)
```python
# ê¸°ì¡´: ì‹œë¦¬ì–¼ í†µì‹  ì§ì ‘ êµ¬í˜„
# ë¬¸ì œ: automation.pyì™€ ë‹¤ë¥¸ ë¡œì§ ì‚¬ìš©

# í•´ê²°: automation.pyì˜ send_cmd í•¨ìˆ˜ ì‚¬ìš©
from automation import send_cmd

@app.route('/api/actuator/toggle', methods=['POST'])
def api_actuator_toggle():
    # ...
    success = send_cmd(ser_b, ser_b_lock, cmd, caller_info=f"[Web] {actuator_type}")
    # ...
```

#### íš¨ê³¼
- âœ… ì‹œë¦¬ì–¼ í†µì‹  ë¡œì§ ì¼ê´€ì„± í™•ë³´
- âœ… ì½”ë“œ ì¤‘ë³µ ì œê±°
- âœ… ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ

---

## ðŸ”„ ì‹œë„í–ˆë˜ ë°©ë²•ë“¤ (ìµœì¢… í•´ê²° ì „)

### 1. LED ìžë™ on/off ê¸°ëŠ¥ ì¶”ê°€ (ì‹¤íŒ¨)

#### ì‹œë„ ë‚´ìš©
- ìˆ˜ë™ ì´¬ì˜ ì‹œ ì¡°ë„ê°€ ë‚®ìœ¼ë©´ ìžë™ìœ¼ë¡œ LED ì¼œê¸°
- ì´¬ì˜ ì™„ë£Œ í›„ LED ìžë™ ë„ê¸°

#### ë¬¸ì œì 
- LED í† ê¸€ê³¼ ì‹¤ì‹œê°„ ì´¬ì˜ ê¸°ëŠ¥ ê°„ ì¶©ëŒ ë°œìƒ
- ì‚¬ìš©ìžê°€ ì˜ë„í•˜ì§€ ì•Šì€ LED ì œì–´ ë°œìƒ

#### ê²°ê³¼
- âŒ ì‚¬ìš©ìž ìš”ì²­ìœ¼ë¡œ ì œê±°ë¨

### 2. manual_override í”Œëž˜ê·¸ ë„ìž… (ë¶€ë¶„ ì„±ê³µ í›„ ì œê±°)

#### ì‹œë„ ë‚´ìš©
```python
# ìˆ˜ë™ ì œì–´ í›„ ì¼ì • ì‹œê°„ ë™ì•ˆ ìžë™ ì œì–´ ë¬´ì‹œ
sys_state[f'{actuator_type}_manual_override'] = time.time() + 300  # 5ë¶„

# automation.pyì—ì„œ í™•ì¸
led_w_manual_active = current_time < led_w_manual_override
if config.USE_AUTO_LED and not led_w_manual_active:
    # ìžë™ ì œì–´ ìˆ˜í–‰
```

#### ë¬¸ì œì 
- ì‚¬ìš©ìžê°€ "1ì‹œê°„ ë™ì•ˆ ìžë™ì œì–´ ë¬´ì‹œëŠ” ë­ì•¼?"ë¼ê³  ì§ˆë¬¸
- ìˆ˜ë™ ì œì–´ì™€ ìžë™ ì œì–´ê°€ ìžì—°ìŠ¤ëŸ½ê²Œ ê³µì¡´í•´ì•¼ í•¨
- í”Œëž˜ê·¸ ê¸°ë°˜ ì œì–´ëŠ” ë³µìž¡ë„ë§Œ ì¦ê°€

#### ê²°ê³¼
- âš ï¸ ë¶€ë¶„ì ìœ¼ë¡œ ìž‘ë™í–ˆì§€ë§Œ ì‚¬ìš©ìž ìš”ì²­ìœ¼ë¡œ ì œê±°ë¨
- ìµœì¢…ì ìœ¼ë¡œ ìˆ˜ë™ ì œì–´ì™€ ìžë™ ì œì–´ê°€ ìžì—°ìŠ¤ëŸ½ê²Œ ê³µì¡´í•˜ë„ë¡ ìˆ˜ì •

### 3. ê³¼ë„í•œ ë””ë²„ê¹… ë¡œê·¸ ì¶”ê°€ (ì§„ë‹¨ìš©)

#### ì‹œë„ ë‚´ìš©
```python
logger.info(f"[Web] ðŸ” ë””ë²„ê¹…: ser_b={ser_b}, ser_b is None={ser_b is None}")
logger.info(f"[Web] ðŸ” ë””ë²„ê¹…: ser_b.is_open={ser_b.is_open}")
logger.info(f"[Web] ðŸ” ì‹œë¦¬ì–¼ ë½ íšë“ ì‹œë„...")
logger.info(f"[Web] ðŸ” ì‹œë¦¬ì–¼ ë½ íšë“ ì„±ê³µ")
# ... (ìˆ˜ì‹­ ê°œì˜ ë””ë²„ê¹… ë¡œê·¸)
```

#### íš¨ê³¼
- âœ… ë¬¸ì œ ì§„ë‹¨ì— ë„ì›€ë¨
- âŒ ë¡œê·¸ ë…¸ì´ì¦ˆ ì¦ê°€

#### ê²°ê³¼
- ë¬¸ì œ í•´ê²° í›„ ëŒ€ë¶€ë¶„ì˜ ë””ë²„ê¹… ë¡œê·¸ ì œê±°
- í•µì‹¬ ì—ëŸ¬ ë¡œê·¸ë§Œ ìœ ì§€

### 4. ì‹œë¦¬ì–¼ í†µì‹  ì§ì ‘ êµ¬í˜„ (ìž„ì‹œ í•´ê²° ì‹œë„)

#### ì‹œë„ ë‚´ìš©
```python
# send_cmd ëŒ€ì‹  ì§ì ‘ ì‹œë¦¬ì–¼ í†µì‹  êµ¬í˜„
with ser_b_lock:
    bytes_to_send = (cmd + '\n').encode()
    bytes_written = ser_b.write(bytes_to_send)
    ser_b.flush()
    time.sleep(0.2)
```

#### ë¬¸ì œì 
- `automation.py`ì™€ ë‹¤ë¥¸ ë¡œì§ ì‚¬ìš©
- ì½”ë“œ ì¤‘ë³µ
- ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€

#### ê²°ê³¼
- âŒ ìµœì¢…ì ìœ¼ë¡œ `send_cmd` í•¨ìˆ˜ ì‚¬ìš©ìœ¼ë¡œ í†µì¼

---

## ðŸ“Š ìµœì¢… ì•„í‚¤í…ì²˜

### ë³€ê²½ ì „
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  smartfarm      â”‚         â”‚  smartfarm-web  â”‚
â”‚  service        â”‚         â”‚  service        â”‚
â”‚  (main.py)      â”‚         â”‚  (web_server.py) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                           â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
              â”‚ /dev/ttyACM0 â”‚
              â”‚  (Board B)   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         âš ï¸ ì‹œë¦¬ì–¼ í¬íŠ¸ ì¶©ëŒ!
```

### ë³€ê²½ í›„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      smartfarm service           â”‚
â”‚         (main.py)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ì„¼ì„œ     â”‚  â”‚ ì›¹ ì„œë²„      â”‚ â”‚
â”‚  â”‚ ìŠ¤ë ˆë“œ   â”‚  â”‚ ìŠ¤ë ˆë“œ       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ìžë™í™”   â”‚  â”‚ ì¹´ë©”ë¼       â”‚ â”‚
â”‚  â”‚ ìŠ¤ë ˆë“œ   â”‚  â”‚ ìŠ¤ë ˆë“œ       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
         â”‚ /dev/ttyACM0 â”‚
         â”‚  (Board B)   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    âœ… ë‹¨ì¼ í”„ë¡œì„¸ìŠ¤ì—ì„œ ê´€ë¦¬
```

---

## ðŸŽ¯ í•´ê²° íš¨ê³¼

### 1. ê¸°ëŠ¥ ì •ìƒí™”
- âœ… ì›¹ UIì—ì„œ LED í† ê¸€ ë²„íŠ¼ í´ë¦­ ì‹œ ë¬¼ë¦¬ì  LED ì •ìƒ ìž‘ë™
- âœ… UI ìƒíƒœì™€ ì‹¤ì œ í•˜ë“œì›¨ì–´ ìƒíƒœ ì¼ì¹˜
- âœ… ìˆ˜ë™ ì œì–´ì™€ ìžë™ ì œì–´ê°€ ìžì—°ìŠ¤ëŸ½ê²Œ ê³µì¡´

### 2. ì‹œìŠ¤í…œ ì•ˆì •ì„± í–¥ìƒ
- âœ… ì‹œë¦¬ì–¼ í¬íŠ¸ ì¶©ëŒ ì™„ì „ í•´ê²°
- âœ… ë‹¨ì¼ í”„ë¡œì„¸ìŠ¤ë¡œ ëª¨ë“  ê¸°ëŠ¥ í†µí•© ê´€ë¦¬
- âœ… ì‹œìŠ¤í…œ êµ¬ì¡° ë‹¨ìˆœí™”

### 3. ì½”ë“œ í’ˆì§ˆ ê°œì„ 
- âœ… ì‹œë¦¬ì–¼ í†µì‹  ë¡œì§ í†µì¼ (`send_cmd` í•¨ìˆ˜ ì‚¬ìš©)
- âœ… ê³¼ë„í•œ ë””ë²„ê¹… ë¡œê·¸ ì •ë¦¬
- âœ… ì½”ë“œ ì¤‘ë³µ ì œê±°

### 4. ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ
- âœ… ë‹¨ì¼ ì„œë¹„ìŠ¤ë¡œ ê´€ë¦¬ ìš©ì´
- âœ… ì‹œë¦¬ì–¼ í¬íŠ¸ ê´€ë ¨ ë¬¸ì œ ì¶”ì  ìš©ì´
- âœ… ì½”ë“œ ì¼ê´€ì„± í™•ë³´

---

## ðŸ“ ìˆ˜ì •ëœ íŒŒì¼ ëª©ë¡

### 1. main.py
- ì›¹ ì„œë²„ë¥¼ ìŠ¤ë ˆë“œë¡œ ì‹¤í–‰í•˜ë„ë¡ ë³€ê²½
- `ser_b`ì™€ `ser_b_lock`ì„ `web_server.py`ì— ì „ë‹¬

### 2. web_server.py
- `send_cmd` í•¨ìˆ˜ ì‚¬ìš©ìœ¼ë¡œ ë³€ê²½
- ê³¼ë„í•œ ë””ë²„ê¹… ë¡œê·¸ ì œê±°
- `init_serial_connection()` ë¡œê·¸ ê°„ì†Œí™”

### 3. automation.py
- `send_cmd` í•¨ìˆ˜ ê°„ì†Œí™” (ë¶ˆí•„ìš”í•œ `inspect` ì œê±°)
- ë””ë²„ê¹… ë¡œê·¸ ì •ë¦¬
- `caller_info` ë§¤ê°œë³€ìˆ˜ ì¶”ê°€ (ì„ íƒì )

### 4. board_b/board_b.ino
- `setLedBrightnessImmediate()`ì—ì„œ `ledFadeCurrentBrightness` ì—…ë°ì´íŠ¸ ì¶”ê°€
- `stopLedFade()`ì—ì„œ ìƒíƒœ ì¼ê´€ì„± í™•ë³´

### 5. my_aliases
- ì›¹ ì„œë²„ ë‹¨ë… ë™ìž‘ ê´€ë ¨ alias ì œê±° (`web-on`, `web-off` ë“±)
- ë¡œê·¸ ë° ë°ì´í„° í™•ì¸ alias ì¶”ê°€ (`farm-log`, `farm-img` ë“±)

---

## ðŸ”§ ì¶”ê°€ ê°œì„  ì‚¬í•­

### 1. ì½”ë“œ ì •ë¦¬
- ê³¼ë„í•œ ë””ë²„ê¹… ë¡œê·¸ ì œê±°
- ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì½”ë“œ ì œê±°
- ì½”ë“œ ì¼ê´€ì„± í™•ë³´

### 2. ë¬¸ì„œí™”
- `my_aliases` íŒŒì¼ ì—…ë°ì´íŠ¸
- `farm-help` í•¨ìˆ˜ì— ì›¹ ì„œë²„ ê´€ë ¨ ì„¤ëª… ì œê±°

### 3. ì‹œìŠ¤í…œ êµ¬ì¡° ë‹¨ìˆœí™”
- ë‹¨ì¼ ì„œë¹„ìŠ¤ë¡œ ëª¨ë“  ê¸°ëŠ¥ í†µí•©
- ì‹œë¦¬ì–¼ í¬íŠ¸ ê´€ë¦¬ ë‹¨ì¼í™”

---

## âœ… ê²€ì¦ ì™„ë£Œ

### í…ŒìŠ¤íŠ¸ í•­ëª©
1. âœ… ì›¹ UIì—ì„œ LED í† ê¸€ ë²„íŠ¼ í´ë¦­ ì‹œ ë¬¼ë¦¬ì  LED ì •ìƒ ìž‘ë™
2. âœ… UI ìƒíƒœì™€ ì‹¤ì œ í•˜ë“œì›¨ì–´ ìƒíƒœ ì¼ì¹˜
3. âœ… ìžë™ ì œì–´ ê¸°ëŠ¥ ì •ìƒ ìž‘ë™ (ì˜¤ì „/ì˜¤í›„ ì ë“±/ì†Œë“±)
4. âœ… ìˆ˜ë™ ì œì–´ì™€ ìžë™ ì œì–´ ê³µì¡´ ì •ìƒ ìž‘ë™
5. âœ… ì‹œë¦¬ì–¼ í¬íŠ¸ ì¶©ëŒ ì—†ìŒ
6. âœ… ëª¨ë“  ê¸°ëŠ¥ ì •ìƒ ìž‘ë™ í™•ì¸

### ì‚¬ìš©ìž í”¼ë“œë°±
- "ì˜¤! ë§ˆì¹¨ë‚´ í•´ê²°ëì–´. ê³ ìƒí–ˆë‹¤."
- "ì•„ì£¼ ì¢‹ì•„. ì–´ë ¤ìš´ ë¯¸ì…˜ì„ ìž˜ ë§ˆì³¤ë‹¤ ê³ ìƒë§Žì•˜ì–´."

---

## ðŸ“š êµí›ˆ ë° ì£¼ì˜ì‚¬í•­

### 1. ì‹œë¦¬ì–¼ í¬íŠ¸ ê´€ë¦¬
- **ì£¼ì˜**: ì‹œë¦¬ì–¼ í¬íŠ¸ëŠ” ë‹¨ì¼ í”„ë¡œì„¸ìŠ¤ì—ì„œë§Œ ì—´ì–´ì•¼ í•¨
- **í•´ê²°**: ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ê°™ì€ ì‹œë¦¬ì–¼ í¬íŠ¸ë¥¼ ê³µìœ í•  ë•ŒëŠ” ë°˜ë“œì‹œ `Lock` ì‚¬ìš©
- **ê¶Œìž¥**: ë‹¨ì¼ í”„ë¡œì„¸ìŠ¤ì—ì„œ ëª¨ë“  ì‹œë¦¬ì–¼ í†µì‹  í†µí•© ê´€ë¦¬

### 2. ìƒíƒœ ê´€ë¦¬ ì¼ê´€ì„±
- **ì£¼ì˜**: í•˜ë“œì›¨ì–´ ìƒíƒœì™€ ì†Œí”„íŠ¸ì›¨ì–´ ìƒíƒœê°€ ì¼ì¹˜í•´ì•¼ í•¨
- **í•´ê²°**: ìƒíƒœ ë³€ê²½ ì‹œ ëª¨ë“  ê´€ë ¨ ë³€ìˆ˜ ì—…ë°ì´íŠ¸
- **ê¶Œìž¥**: ìƒíƒœ ë³€ê²½ í•¨ìˆ˜ì—ì„œ ì¼ê´€ì„± ê²€ì¦ ë¡œì§ ì¶”ê°€

### 3. ë””ë²„ê¹… ë¡œê·¸ ê´€ë¦¬
- **ì£¼ì˜**: ê³¼ë„í•œ ë””ë²„ê¹… ë¡œê·¸ëŠ” ë¬¸ì œ ì§„ë‹¨ì„ ì–´ë µê²Œ ë§Œë“¦
- **í•´ê²°**: ë¬¸ì œ í•´ê²° í›„ ë¶ˆí•„ìš”í•œ ë¡œê·¸ ì œê±°
- **ê¶Œìž¥**: í•µì‹¬ ì—ëŸ¬ ë¡œê·¸ë§Œ ìœ ì§€, DEBUG ë ˆë²¨ ë¡œê·¸ëŠ” ê°œë°œ ì¤‘ì—ë§Œ ì‚¬ìš©

### 4. ì½”ë“œ í†µí•©
- **ì£¼ì˜**: ê°™ì€ ê¸°ëŠ¥ì„ ì—¬ëŸ¬ ê³³ì—ì„œ êµ¬í˜„í•˜ë©´ ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€
- **í•´ê²°**: ê³µí†µ í•¨ìˆ˜ë¡œ í†µí•© (`send_cmd` ë“±)
- **ê¶Œìž¥**: DRY(Don't Repeat Yourself) ì›ì¹™ ì¤€ìˆ˜

---

## ðŸ”® í–¥í›„ ê°œì„  ê°€ëŠ¥ ì‚¬í•­

### 1. ì—ëŸ¬ ì²˜ë¦¬ ê°•í™”
- ì‹œë¦¬ì–¼ í¬íŠ¸ ì—°ê²° ì‹¤íŒ¨ ì‹œ ìžë™ ìž¬ì—°ê²°
- íƒ€ìž„ì•„ì›ƒ ì²˜ë¦¬ ê°œì„ 
- ì—ëŸ¬ ë³µêµ¬ ë©”ì»¤ë‹ˆì¦˜ ì¶”ê°€

### 2. ëª¨ë‹ˆí„°ë§ ê°œì„ 
- ì‹œë¦¬ì–¼ í†µì‹  ì„±ê³µ/ì‹¤íŒ¨ í†µê³„
- í•˜ë“œì›¨ì–´ ìƒíƒœ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ
- ì•Œë¦¼ ì‹œìŠ¤í…œ ê°œì„ 

### 3. í…ŒìŠ¤íŠ¸ ìžë™í™”
- ì‹œë¦¬ì–¼ í†µì‹  ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- í†µí•© í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
- í•˜ë“œì›¨ì–´ ì‹œë®¬ë ˆì´ì…˜

---

---

## ðŸ¤” ì¶”ê°€ ë¶„ì„: Fan/ValveëŠ” ì™œ ì •ìƒ ìž‘ë™í–ˆì„ê¹Œ?

### í•µì‹¬ ì°¨ì´ì 

LEDë§Œ ë¬¸ì œê°€ ìžˆì—ˆë˜ ì´ìœ ëŠ” **ì œì–´ ë°©ì‹ì˜ ê·¼ë³¸ì  ì°¨ì´** ë•Œë¬¸ìž…ë‹ˆë‹¤.

#### 1. Fanê³¼ Valve: ëª…ë ¹ ê¸°ë°˜ ì œì–´ (Command-based Control)

```cpp
// Fan ì œì–´
else if (cmd == "FAN_ON") { 
    analogWrite(PIN_FAN, 255);  // ì¦‰ì‹œ ì‹¤í–‰, ë
}
else if (cmd == "FAN_OFF") { 
    analogWrite(PIN_FAN, 0);    // ì¦‰ì‹œ ì‹¤í–‰, ë
}

// Valve ì œì–´
else if (cmd == "M1") { 
    valveStatus = !valveStatus; 
    digitalWrite(PIN_VALVE, valveStatus);  // ì¦‰ì‹œ ì‹¤í–‰, ë
}
```

**íŠ¹ì§•:**
- âœ… ëª…ë ¹ì´ ì˜¤ë©´ ì¦‰ì‹œ ì‹¤í–‰ë˜ê³  ë
- âœ… ë°±ê·¸ë¼ìš´ë“œ í”„ë¡œì„¸ìŠ¤ ì—†ìŒ
- âœ… ìƒíƒœ ê´€ë¦¬ ë‹¨ìˆœ (ON/OFFë§Œ)
- âœ… ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ì™€ ì¶©ëŒí•  ì—¬ì§€ ì—†ìŒ

#### 2. LED: ìƒíƒœ ê¸°ë°˜ ì œì–´ (State-based Control)

```cpp
// LED ì œì–´
else if (cmd == "LED_ON") {
    setLedBrightnessImmediate(3);  // í•¨ìˆ˜ í˜¸ì¶œ
}
else if (cmd == "LED_FADE_ON") {
    startLedFade(LED_BRIGHTNESS_VALUES[3]);  // íŽ˜ì´ë“œ ì‹œìž‘
}

void loop() {
    updateLedFade();  // âš ï¸ ë§¤ ë£¨í”„ë§ˆë‹¤ ì‹¤í–‰ë˜ëŠ” ë°±ê·¸ë¼ìš´ë“œ í”„ë¡œì„¸ìŠ¤
    updatePurpleFade();
    // ...
}
```

**íŠ¹ì§•:**
- âš ï¸ ëª…ë ¹ì´ ì˜¤ë©´ ìƒíƒœ ë³€ìˆ˜ë§Œ ë³€ê²½
- âš ï¸ `updateLedFade()`ê°€ ë§¤ ë£¨í”„ë§ˆë‹¤ ì‹¤í–‰ë˜ì–´ ì‹¤ì œ í•˜ë“œì›¨ì–´ ì œì–´
- âš ï¸ ë³µìž¡í•œ ìƒíƒœ ê´€ë¦¬ (ë°ê¸° ë ˆë²¨, íŽ˜ì´ë“œ ìƒíƒœ, í˜„ìž¬ ë°ê¸° ë“±)
- âš ï¸ ìƒíƒœ ë³€ìˆ˜ ë¶ˆì¼ì¹˜ ì‹œ ì¦‰ì‹œ ì œì–´ê°€ ë®ì–´ì“°ì¼ ìˆ˜ ìžˆìŒ

### ë¬¸ì œ ë°œìƒ ë©”ì»¤ë‹ˆì¦˜

#### ì‹œë‚˜ë¦¬ì˜¤: ì›¹ UIì—ì„œ LED_ON ëª…ë ¹ ì „ì†¡

1. **ëª…ë ¹ ìˆ˜ì‹ **: `LED_ON` ëª…ë ¹ì´ Arduinoì— ë„ì°©
2. **ì¦‰ì‹œ ì œì–´**: `setLedBrightnessImmediate(3)` í˜¸ì¶œ
   ```cpp
   void setLedBrightnessImmediate(int level) {
       stopLedFade();
       ledBrightnessLevel = 3;
       analogWrite(PIN_LED_W, 255);  // âœ… LED ì¼œì§
       // âŒ ë¬¸ì œ: ledFadeCurrentBrightnessë¥¼ ì—…ë°ì´íŠ¸í•˜ì§€ ì•ŠìŒ
   }
   ```
3. **ë°±ê·¸ë¼ìš´ë“œ í”„ë¡œì„¸ìŠ¤**: `loop()`ì—ì„œ ê³„ì† ì‹¤í–‰ë˜ëŠ” `updateLedFade()`
   ```cpp
   void updateLedFade() {
       if (!ledFadeActive) return;  // âœ… íŽ˜ì´ë“œê°€ ë¹„í™œì„±í™”ë˜ì–´ ìžˆìœ¼ë©´ ë¦¬í„´
       // í•˜ì§€ë§Œ ledFadeCurrentBrightnessëŠ” ì´ì „ ê°’ìœ¼ë¡œ ë‚¨ì•„ìžˆìŒ
   }
   ```
4. **ìƒíƒœ ë¶ˆì¼ì¹˜**: ë§Œì•½ `ledFadeActive`ê°€ `true`ë¡œ ë‚¨ì•„ìžˆë‹¤ë©´?
   - `updateLedFade()`ê°€ ì´ì „ íŽ˜ì´ë“œ ë°ê¸°ë¡œ ë®ì–´ì”€
   - ì¦‰ì‹œ ì„¤ì •í•œ ë°ê¸°ê°€ ë¬´ì‹œë¨

#### ë°˜ë©´ Fan/ValveëŠ”?

1. **ëª…ë ¹ ìˆ˜ì‹ **: `FAN_ON` ëª…ë ¹ì´ Arduinoì— ë„ì°©
2. **ì¦‰ì‹œ ì œì–´**: `analogWrite(PIN_FAN, 255)` ì‹¤í–‰
3. **ë**: ë” ì´ìƒ ì²˜ë¦¬í•  ê²ƒì´ ì—†ìŒ
4. **ë°±ê·¸ë¼ìš´ë“œ í”„ë¡œì„¸ìŠ¤ ì—†ìŒ**: ë®ì–´ì“¸ í”„ë¡œì„¸ìŠ¤ê°€ ì—†ìŒ

### ì™œ LEDë§Œ íŽ˜ì´ë“œ ê¸°ëŠ¥ì´ í•„ìš”í•œê°€?

#### LED íŽ˜ì´ë“œ ê¸°ëŠ¥ì˜ ëª©ì 
- **ê´‘ì¶©ê²© ë°©ì§€**: ê°‘ìž‘ìŠ¤ëŸ¬ìš´ ë°ê¸° ë³€í™”ëŠ” ì‹ë¬¼ì— ìŠ¤íŠ¸ë ˆìŠ¤
- **ë¶€ë“œëŸ¬ìš´ ì „í™˜**: 10ë¶„ì— ê±¸ì³ ì„œì„œížˆ ë°ì•„ì§€ê±°ë‚˜ ì–´ë‘ì›Œì§
- **ìžì—°ìŠ¤ëŸ¬ìš´ í™˜ê²½**: ì¼ì¶œ/ì¼ëª°ê³¼ ìœ ì‚¬í•œ íš¨ê³¼

#### Fan/ValveëŠ” íŽ˜ì´ë“œ ë¶ˆí•„ìš”
- **Fan**: ì¼œê³  ë„ëŠ” ê²ƒì´ ëª©ì , ì†ë„ ì¡°ì ˆ ë¶ˆí•„ìš”
- **Valve**: ë¬¼ ê³µê¸‰/ì°¨ë‹¨ì´ ëª©ì , ì ì§„ì  ì œì–´ ë¶ˆí•„ìš”

### ê²°ë¡ 

| êµ¬ë™ê³„ | ì œì–´ ë°©ì‹ | ë°±ê·¸ë¼ìš´ë“œ í”„ë¡œì„¸ìŠ¤ | ìƒíƒœ ê´€ë¦¬ | ë¬¸ì œ ë°œìƒ ê°€ëŠ¥ì„± |
|--------|----------|-------------------|----------|----------------|
| **Fan** | ëª…ë ¹ ê¸°ë°˜ | ì—†ìŒ | ë‹¨ìˆœ (ON/OFF) | ë‚®ìŒ âœ… |
| **Valve** | ëª…ë ¹ ê¸°ë°˜ | ì—†ìŒ | ë‹¨ìˆœ (ON/OFF) | ë‚®ìŒ âœ… |
| **LED** | ìƒíƒœ ê¸°ë°˜ | ìžˆìŒ (`updateLedFade()`) | ë³µìž¡ (ë°ê¸°, íŽ˜ì´ë“œ ë“±) | ë†’ìŒ âš ï¸ |

**í•µì‹¬ êµí›ˆ:**
- ìƒíƒœ ê¸°ë°˜ ì œì–´ ì‹œìŠ¤í…œì—ì„œëŠ” **ëª¨ë“  ìƒíƒœ ë³€ìˆ˜ë¥¼ ì¼ê´€ë˜ê²Œ ê´€ë¦¬**í•´ì•¼ í•¨
- ë°±ê·¸ë¼ìš´ë“œ í”„ë¡œì„¸ìŠ¤ê°€ ìžˆëŠ” ì‹œìŠ¤í…œì—ì„œëŠ” **ìƒíƒœ ë³€ê²½ ì‹œ ê´€ë ¨ ë³€ìˆ˜ ëª¨ë‘ ì—…ë°ì´íŠ¸** í•„ìš”
- ëª…ë ¹ ê¸°ë°˜ ì œì–´ëŠ” ë‹¨ìˆœí•˜ê³  ì•ˆì •ì ì´ì§€ë§Œ, ìƒíƒœ ê¸°ë°˜ ì œì–´ëŠ” ìœ ì—°í•˜ì§€ë§Œ ë³µìž¡í•¨

---

---

## ðŸ”— ì—°ì‡„ íš¨ê³¼: ì‹œë¦¬ì–¼ í¬íŠ¸ ì¶©ëŒì´ ë‹¤ë¥¸ ê¸°ëŠ¥ì— ë¯¸ì¹œ ì˜í–¥

### ë°œê²¬ëœ í˜„ìƒ

ì›¹ ì„œë²„ë§Œ ìˆ˜ì •í–ˆëŠ”ë°, ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œë“¤ì´ ë™ì‹œì— í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤:
1. **Discord ë©”ì‹œì§€ì— 0.0 ê°’ì´ ê³„ì† ë“¤ì–´ê°€ëŠ” ë¬¸ì œ**
2. **ì¡°ë„ 100 ì´í•˜ì¼ ë•Œ ì´¬ì˜í•˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥ì´ ìž‘ë™í•˜ì§€ ì•Šë˜ ë¬¸ì œ**

### ê·¼ë³¸ ì›ì¸ ë¶„ì„

ì‹œë¦¬ì–¼ í¬íŠ¸ ì¶©ëŒì´ **ë‹¨ìˆœížˆ LED ì œì–´ë§Œ** ë¬¸ì œê°€ ì•„ë‹ˆë¼, **ì „ì²´ ì‹œìŠ¤í…œì˜ ë°ì´í„° íë¦„**ì— ì˜í–¥ì„ ë¯¸ì³¤ìŠµë‹ˆë‹¤.

#### ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Board A    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   main.py   â”‚
â”‚  (ì„¼ì„œ)     â”‚  ser_a  â”‚  (ì„¼ì„œ ìˆ˜ì‹ ) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ sys_state ì—…ë°ì´íŠ¸
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                       â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ automation.py â”‚      â”‚   camera.py     â”‚
            â”‚ (ìžë™í™” ì œì–´) â”‚      â”‚  (ì¹´ë©”ë¼ ì œì–´)  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                      â”‚
                    â”‚                      â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚         sys_state (ê³µìœ  ìƒíƒœ)          â”‚
            â”‚  - temp, hum, soil_pct, lux, vpd        â”‚
            â”‚  - fan_status, valve_status, etc.      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ë¬¸ì œ ë°œìƒ ë©”ì»¤ë‹ˆì¦˜

##### 1. ì‹œë¦¬ì–¼ í¬íŠ¸ ì¶©ëŒì˜ ì „íŒŒ íš¨ê³¼

**ì‹œë‚˜ë¦¬ì˜¤: `main.py`ì™€ `web_server.py`ê°€ ë™ì‹œì— `ser_b` ì‚¬ìš© ì‹œë„**

```python
# main.py (smartfarm.service)
ser_b = serial.Serial('/dev/ttyACM0', 9600)  # âœ… ì„±ê³µ

# web_server.py (smartfarm-web.service) - ë™ì‹œ ì‹¤í–‰
ser_b = serial.Serial('/dev/ttyACM0', 9600)  # âŒ ì‹¤íŒ¨ ë˜ëŠ” ë¶ˆì•ˆì •
```

**ì˜í–¥:**
- ì‹œë¦¬ì–¼ í¬íŠ¸ê°€ ë¶ˆì•ˆì •í•´ì§€ë©´ **ì „ì²´ ì‹œë¦¬ì–¼ í†µì‹ ì— ê°„ì„­** ë°œìƒ
- Linux ì‹œë¦¬ì–¼ ë“œë¼ì´ë²„ ë ˆë²¨ì—ì„œ ì¶©ëŒ ë°œìƒ ê°€ëŠ¥
- `ser_a` (Board A)ì™€ `ser_b` (Board B)ê°€ ê°™ì€ USB í—ˆë¸Œë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, í•œìª½ ì¶©ëŒì´ ë‹¤ë¥¸ìª½ì— ì˜í–¥

##### 2. Discord ë©”ì‹œì§€ì— 0.0 ê°’ì´ ë“¤ì–´ê°€ëŠ” ë¬¸ì œ

**ë°ì´í„° íë¦„:**
```
Board A (ì„¼ì„œ) 
  â†’ serial_thread_A (main.py)
  â†’ sys_state ì—…ë°ì´íŠ¸
  â†’ automation.py (ìžë™í™” ë£¨í”„)
  â†’ analyzer.py (ìƒíƒœ ë¶„ì„)
  â†’ discord_notifier.py (ì•Œë¦¼ ì „ì†¡)
```

**ë¬¸ì œ ë°œìƒ ê³¼ì •:**

1. **ì‹œë¦¬ì–¼ í¬íŠ¸ ì¶©ëŒ ë°œìƒ**
   ```python
   # web_server.pyê°€ ser_bë¥¼ ì—´ë ¤ê³  ì‹œë„
   # â†’ ì‹œë¦¬ì–¼ ë“œë¼ì´ë²„ ë ˆë²¨ì—ì„œ ì¶©ëŒ
   # â†’ ser_a í†µì‹ ë„ ê°„í—ì ìœ¼ë¡œ ì‹¤íŒ¨
   ```

2. **ì„¼ì„œ ë°ì´í„° ìˆ˜ì‹  ì‹¤íŒ¨/ë¶ˆì•ˆì •**
   ```python
   # main.pyì˜ serial_thread_A
   def serial_thread_A(ser_a, ...):
       while not stop_event.is_set():
           if not ser_a.in_waiting:
               time.sleep(0.1)
               continue
           raw_line = ser_a.readline()  # âŒ ê°„í—ì ìœ¼ë¡œ ì‹¤íŒ¨
   ```

3. **sys_state ì—…ë°ì´íŠ¸ ì‹¤íŒ¨**
   ```python
   # ì„¼ì„œ ë°ì´í„°ê°€ ìˆ˜ì‹ ë˜ì§€ ì•Šìœ¼ë©´
   # sys_stateì˜ ê°’ì´ ì—…ë°ì´íŠ¸ë˜ì§€ ì•ŠìŒ
   # â†’ ê¸°ì¡´ ê°’ ìœ ì§€ ë˜ëŠ” ì´ˆê¸°ê°’(0.0) ìœ ì§€
   
   # main.pyì˜ serial_thread_A
   elif line.startswith("DATA"):
       with state_lock:
           sys_state['temp'] = float(parts[1])  # âŒ ë°ì´í„° ìˆ˜ì‹  ì‹¤íŒ¨ ì‹œ ì‹¤í–‰ ì•ˆ ë¨
           sys_state['lux'] = int(lux_value)    # âŒ ì—…ë°ì´íŠ¸ ì•ˆ ë¨
   ```

4. **automation.pyì—ì„œ 0.0 ê°’ ì½ê¸°**
   ```python
   # automation.pyì˜ automation_loop
   with state_lock:
       curr_temp = sys_state.get('temp', 0)      # âŒ 0.0 ë°˜í™˜
       curr_hum = sys_state.get('hum', 0)       # âŒ 0.0 ë°˜í™˜
       curr_lux = sys_state.get('lux', 0)        # âŒ 0.0 ë°˜í™˜
   ```

5. **Discord ì•Œë¦¼ì— 0.0 ê°’ ì „ë‹¬**
   ```python
   # automation.py
   current_status = {
       'Temp_C': curr_temp,      # 0.0
       'Hum_Pct': curr_hum,      # 0.0
       'Lux': curr_lux,          # 0.0
   }
   
   alerts = analyzer.analyze_current_status(current_status)
   # â†’ Discordì— 0.0 ê°’ì´ í¬í•¨ëœ ì•Œë¦¼ ì „ì†¡
   ```

**í•´ê²° í›„:**
- ì‹œë¦¬ì–¼ í¬íŠ¸ ì¶©ëŒ í•´ê²° â†’ `ser_a` í†µì‹  ì•ˆì •í™”
- ì„¼ì„œ ë°ì´í„° ì •ìƒ ìˆ˜ì‹  â†’ `sys_state` ì •ìƒ ì—…ë°ì´íŠ¸
- Discord ì•Œë¦¼ì— ì •ìƒ ê°’ ì „ë‹¬ âœ…

##### 3. ì¡°ë„ 100 ì´í•˜ì¼ ë•Œ ì´¬ì˜í•˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥ ë¯¸ìž‘ë™

**ë°ì´í„° íë¦„:**
```
Board A (ì„¼ì„œ) 
  â†’ serial_thread_A (main.py)
  â†’ sys_state['lux'] ì—…ë°ì´íŠ¸
  â†’ camera.py (ì´¬ì˜ ê²°ì •)
```

**ë¬¸ì œ ë°œìƒ ê³¼ì •:**

1. **ì‹œë¦¬ì–¼ í¬íŠ¸ ì¶©ëŒë¡œ ì¸í•œ ì„¼ì„œ ë°ì´í„° ìˆ˜ì‹  ì‹¤íŒ¨**
   ```python
   # main.pyì˜ serial_thread_A
   # â†’ DATA íŒ¨í‚· ìˆ˜ì‹  ì‹¤íŒ¨ ë˜ëŠ” ì§€ì—°
   # â†’ sys_state['lux'] ì—…ë°ì´íŠ¸ ì•ˆ ë¨
   ```

2. **camera.pyì—ì„œ ì˜¤ëž˜ëœ ê°’ ë˜ëŠ” 0 ì½ê¸°**
   ```python
   # camera.pyì˜ capture_image
   def capture_image(self, tag="Auto"):
       if tag == "Auto":
           if self.sys_state and self.state_lock:
               with self.state_lock:
                   current_lux = self.sys_state.get('lux', 0)  # âŒ 0 ë˜ëŠ” ì˜¤ëž˜ëœ ê°’
               if current_lux <= 100:
                   app_logger.info(f"[Cam] âš ï¸ ì¡°ë„ê°€ ë‚®ì•„ ìžë™ ì´¬ì˜ ê±´ë„ˆëœ€")
                   return
   ```

3. **ì¡°ë„ í™•ì¸ ë¡œì§ ì‹¤íŒ¨**
   - `current_lux`ê°€ 0ì´ë©´ â†’ í•­ìƒ 100 ì´í•˜ â†’ í•­ìƒ ì´¬ì˜ ì•ˆ í•¨ (ì˜ë„ì™€ ë‹¤ë¦„)
   - `current_lux`ê°€ ì˜¤ëž˜ëœ ê°’ì´ë©´ â†’ ì‹¤ì œ ì¡°ë„ì™€ ë¶ˆì¼ì¹˜ â†’ ìž˜ëª»ëœ íŒë‹¨

**í•´ê²° í›„:**
- ì‹œë¦¬ì–¼ í¬íŠ¸ ì¶©ëŒ í•´ê²° â†’ `ser_a` í†µì‹  ì•ˆì •í™”
- ì„¼ì„œ ë°ì´í„° ì •ìƒ ìˆ˜ì‹  â†’ `sys_state['lux']` ì •ìƒ ì—…ë°ì´íŠ¸
- ì¡°ë„ í™•ì¸ ë¡œì§ ì •ìƒ ìž‘ë™ âœ…

### ì™œ ì‹œë¦¬ì–¼ í¬íŠ¸ ì¶©ëŒì´ ser_aì—ë„ ì˜í–¥ì„ ë¯¸ì³¤ì„ê¹Œ?

#### ê°€ëŠ¥í•œ ì›ì¸ë“¤

1. **USB í—ˆë¸Œ ê³µìœ **
   - Board Aì™€ Board Bê°€ ê°™ì€ USB í—ˆë¸Œë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°
   - í•œ í¬íŠ¸ì˜ ì¶©ëŒì´ ë‹¤ë¥¸ í¬íŠ¸ì— ê°„ì„­ ë°œìƒ ê°€ëŠ¥

2. **ì‹œë¦¬ì–¼ ë“œë¼ì´ë²„ ë ˆë²¨ ì¶©ëŒ**
   - Linux ì‹œë¦¬ì–¼ ë“œë¼ì´ë²„ê°€ ì „ì—­ ë¦¬ì†ŒìŠ¤ë¥¼ ê³µìœ 
   - í•œ í¬íŠ¸ì˜ ë¶ˆì•ˆì •ì´ ë“œë¼ì´ë²„ ì „ì²´ì— ì˜í–¥

3. **ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ê²½ìŸ**
   - ë‘ í”„ë¡œì„¸ìŠ¤ê°€ ë™ì‹œì— ì‹œë¦¬ì–¼ í¬íŠ¸ë¥¼ ì—´ë ¤ê³  ì‹œë„
   - ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤(ë©”ëª¨ë¦¬, CPU) ê²½ìŸìœ¼ë¡œ ì „ì²´ ì„±ëŠ¥ ì €í•˜

4. **í”„ë¡œì„¸ìŠ¤ ê°„ ê°„ì„­**
   - `main.py`ì™€ `web_server.py`ê°€ ê°™ì€ ì‹œë¦¬ì–¼ í¬íŠ¸ë¥¼ ì‚¬ìš©í•˜ë ¤ê³  ì‹œë„
   - í¬íŠ¸ê°€ ìž ê¸°ê±°ë‚˜ ë¶ˆì•ˆì •í•´ì§€ë©´ ë‹¤ë¥¸ ì‹œë¦¬ì–¼ í†µì‹ ì—ë„ ì˜í–¥

### êµí›ˆ

#### 1. ì‹œë¦¬ì–¼ í¬íŠ¸ëŠ” ë‹¨ì¼ í”„ë¡œì„¸ìŠ¤ì—ì„œ ê´€ë¦¬
- âœ… **ì˜¬ë°”ë¥¸ ë°©ë²•**: `main.py`ì—ì„œ ëª¨ë“  ì‹œë¦¬ì–¼ í¬íŠ¸ ê´€ë¦¬, ë‹¤ë¥¸ ëª¨ë“ˆì€ ê³µìœ 
- âŒ **ìž˜ëª»ëœ ë°©ë²•**: ì—¬ëŸ¬ í”„ë¡œì„¸ìŠ¤ê°€ ë™ì¼í•œ ì‹œë¦¬ì–¼ í¬íŠ¸ë¥¼ ë…ë¦½ì ìœ¼ë¡œ ì—´ê¸°

#### 2. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ì˜ ì¤‘ìš”ì„±
- ì‹œë¦¬ì–¼ í¬íŠ¸ ì¶©ëŒì€ ë‹¨ìˆœížˆ í•´ë‹¹ í¬íŠ¸ë§Œì˜ ë¬¸ì œê°€ ì•„ë‹˜
- ì „ì²´ ì‹œìŠ¤í…œì˜ ë°ì´í„° íë¦„ì— ì˜í–¥ì„ ë¯¸ì¹  ìˆ˜ ìžˆìŒ
- í•˜ë‚˜ì˜ ë¬¸ì œê°€ ì—¬ëŸ¬ ê¸°ëŠ¥ì— ì—°ì‡„ì ìœ¼ë¡œ ì˜í–¥ì„ ë¯¸ì¹  ìˆ˜ ìžˆìŒ

#### 3. ìƒíƒœ ê³µìœ ì˜ ì¼ê´€ì„±
- `sys_state`ëŠ” ëª¨ë“  ëª¨ë“ˆì´ ê³µìœ í•˜ëŠ” ì „ì—­ ìƒíƒœ
- í•œ ê³³ì—ì„œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨í•˜ë©´ ëª¨ë“  ëª¨ë“ˆì— ì˜í–¥
- ìƒíƒœ ì—…ë°ì´íŠ¸ì˜ ì•ˆì •ì„±ì´ ì „ì²´ ì‹œìŠ¤í…œ ì•ˆì •ì„±ì˜ í•µì‹¬

#### 4. ë¬¸ì œ ì§„ë‹¨ ì‹œ ì „ì²´ ì‹œìŠ¤í…œ ê´€ì  í•„ìš”
- í‘œë©´ì ìœ¼ë¡œëŠ” LED ë¬¸ì œë¡œ ë³´ì˜€ì§€ë§Œ, ì‹¤ì œë¡œëŠ” ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë¬¸ì œ
- ì—¬ëŸ¬ ë¬¸ì œê°€ ë™ì‹œì— ë°œìƒí•˜ë©´ ê³µí†µ ì›ì¸ì„ ì°¾ì•„ì•¼ í•¨
- ê·¼ë³¸ ì›ì¸ í•´ê²°ì´ ì—¬ëŸ¬ ë¬¸ì œë¥¼ ë™ì‹œì— í•´ê²°í•  ìˆ˜ ìžˆìŒ

### ê²°ë¡ 

ì›¹ ì„œë²„ë¥¼ `main.py` ìŠ¤ë ˆë“œë¡œ í†µí•©í•œ ê²ƒì´ ë‹¨ìˆœížˆ LED ì œì–´ ë¬¸ì œë§Œ í•´ê²°í•œ ê²ƒì´ ì•„ë‹ˆë¼:
1. âœ… ì‹œë¦¬ì–¼ í¬íŠ¸ ì¶©ëŒ ì™„ì „ í•´ê²°
2. âœ… ì„¼ì„œ ë°ì´í„° ìˆ˜ì‹  ì•ˆì •í™”
3. âœ… `sys_state` ì—…ë°ì´íŠ¸ ì •ìƒí™”
4. âœ… Discord ì•Œë¦¼ ì •ìƒ ìž‘ë™
5. âœ… ì¹´ë©”ë¼ ì¡°ë„ í™•ì¸ ê¸°ëŠ¥ ì •ìƒ ìž‘ë™

**í•µì‹¬ êµí›ˆ**: ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ì˜ ê·¼ë³¸ì ì¸ ë¬¸ì œë¥¼ í•´ê²°í•˜ë©´, ê·¸ë¡œ ì¸í•´ ë°œìƒí•œ ì—¬ëŸ¬ í‘œë©´ì  ë¬¸ì œë“¤ì´ ë™ì‹œì— í•´ê²°ë  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

---

**ìž‘ì„± ì™„ë£Œì¼**: 2026-01-10  
**ë¬¸ì œ í•´ê²°ì¼**: 2026-01-10  
**ë‹¤ìŒ ê²€í†  ì˜ˆì •ì¼**: ì‹¤ì œ ìš´ì˜ ì¤‘ ì¶”ê°€ ë¬¸ì œ ë°œìƒ ì‹œ

