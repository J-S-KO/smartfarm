# 웹 대시보드 원격 접속 세팅 기록

**작성일**: 2026-01-03  
**작성자**: Cursor AI  
**주제**: 스마트팜 웹 대시보드 원격 접속을 위한 네트워크 및 공유기 설정

---

## 📋 목표

스마트팜 웹 대시보드를 외부 네트워크에서 접속할 수 있도록 포트포워딩 설정 및 네트워크 환경 최적화. 공유기 설정 변경으로 인한 라즈베리파이 연결 문제 해결 및 안정적인 원격 접속 환경 구축.

---

## 🔵 초기 상황

### 1. 공유기 접속 문제
- **증상**: `192.168.0.1` 접속 불가
- **원인**: 공유기 IP 주소가 변경되었거나 브리지 모드로 동작 중
- **확인 방법**: `ipconfig` 명령어로 기본 게이트웨이 주소 확인

### 기본 게이트웨이 확인 방법
```bash
# Windows
ipconfig
# [기본 게이트웨이] 항목 확인

# 예시 결과
기본 게이트웨이: 192.168.0.253  # 또는 192.168.1.1, 192.168.0.254 등
```

### 2. 공인 IP 노출 문제
- **증상**: `ipconfig` 결과가 `112.181.243.2` 또는 `220.120.29.1` 같은 공인 IP로 표시
- **의미**: 공유기의 방화벽(NAT) 기능이 작동하지 않아 PC가 인터넷에 직접 노출된 상태
- **보안 위험**: 외부에서 직접 접근 가능한 취약한 상태

### 3. 네트워크 구성
- **메인 공유기**: ipTIME Ring Mini 2 (천장 설치, PoE 전원)
- **확장기**: ipTIME Extender Giga (와이파이 확장용)
- **라즈베리파이**: 베란다에 설치, 와이파이 연결

---

## 🟢 해결 과정

### 1. 공유기 관리자 페이지 접속

#### 방법 1: ipTIME 검색기 사용 (가장 확실)
1. ipTIME 홈페이지 > 고객지원 > 다운로드 > [ipTIME 검색기] 다운로드
2. 프로그램 실행 후 [검색] 버튼 클릭
3. 목록에서 공유기 선택 후 더블 클릭
4. [웹 설정 화면 접속] 버튼 클릭

#### 방법 2: 기본 게이트웨이 주소로 접속
- `ipconfig`로 확인한 기본 게이트웨이 주소를 브라우저에 입력
- 예: `http://192.168.0.253` (Ring Mini 2의 경우)
- 주의: `https://`가 아닌 `http://`로 접속

### 2. 공유기 초기화 및 기본 설정

#### 공유기 리셋 방법
1. 전원이 켜진 상태에서 RST(리셋) 버튼을 10초 이상 누름
2. CPU LED가 빠르게 깜빡거리면 손을 뗌
3. 약 3분 대기 후 공장 초기화 완료

#### 초기화 후 확인 사항
- 와이파이 비밀번호가 초기화됨 (비밀번호 없음)
- 관리자 페이지 접속 주소가 기본값으로 변경됨
- DHCP 서버가 꺼져 있을 수 있음

### 3. DHCP 서버 활성화

#### 설정 위치
- 공유기 관리자 페이지 > [고급 설정] > [네트워크 관리] > [내부 네트워크 설정] > [DHCP 서버 설정]

#### 설정 내용
```
DHCP 서버: [실행] ✅
게이트웨이 주소: 192.168.0.253 (또는 192.168.0.1)
IP 주소 범위: 192.168.0.2 ~ 192.168.0.254
임대 시간: 7200초 (2시간)
```

#### 중요 사항
- DHCP가 꺼져 있으면 PC가 공인 IP를 직접 받아 보안 위험
- DHCP를 켜면 모든 기기가 사설 IP(192.168.0.xxx)를 받아 안전함
- 체크박스(등록된 기기만 허용)는 가정용에서는 체크 해제 권장

### 4. WAN 포트 모드 설정 (핵심!)

#### 문제 상황
- Ring Mini 2는 포트가 하나뿐이라 LAN/WAN 역할을 사용자가 지정해야 함
- LAN 포트 모드로 설정되어 있으면 공유기 기능이 작동하지 않음

#### 설정 위치
- [기타 설정] > [유선 포트 기능 설정]

#### 설정 변경
```
기존: [LAN 포트] ❌
변경: [WAN 포트] ✅
```

#### 효과
- 공유기가 인터넷 신호를 받아들일 수 있게 됨
- NAT(방화벽) 기능 활성화
- 내부 네트워크와 외부 인터넷 분리

### 5. Easy Mesh 구성

#### 목적
- 메인 공유기와 Extender를 하나의 네트워크로 통합
- 자동 로밍 기능으로 신호 약한 곳에서도 안정적 연결
- 라즈베리파이 등 IoT 기기의 연결 안정성 향상

#### 구성 순서

**1단계: 메인 공유기 Controller 설정**
```
공유기 관리자 페이지 > [Easy Mesh] 메뉴
Controller 모드 선택
네트워크 이름(SSID) 및 비밀번호 설정
[적용] 클릭
```

**2단계: Extender 초기화**
- Extender의 RST 버튼을 10초 이상 누름
- LED가 깜빡거리면 초기화 완료
- **중요**: 초기화된 Extender만 검색 목록에 나타남

**3단계: Extender 등록**
- Extender를 **메인 공유기 옆**으로 가져옴 (초기 등록 시 필수)
- Easy Mesh 관리자 페이지에서 [검색] 버튼 클릭
- 목록에 나타난 Extender 선택 후 [추가] 클릭
- "Mesh 구성 중..." 메시지 후 연결 완료

**4단계: Extender 재배치**
- 등록 완료 후 원래 위치(베란다/창가)로 이동
- 전원만 뽑아서 옮기면 됨 (설정은 저장됨)
- 2~3분 대기 후 LED 확인

#### Mesh 구성 후 확인 사항
- Extender LED: 파란색(정상), 보라색/주황색(신호 약함), 빨간색(연결 끊김)
- 공유기 관리자 페이지에서 Extender 상태 확인
- Extender IP 주소가 192.168.0.xxx 대역인지 확인 (공인 IP가 아닌지)

### 6. 무선 네트워크 최적화

#### 2.4GHz 설정 (라즈베리파이 연결 안정화)

**채널 크기 (대역폭)**
```
기존: 40MHz (광대역) ❌
변경: 20MHz (표준) ✅
```

**이유**:
- 40MHz는 신호가 넓어서 벽을 통과할 때 노이즈 발생
- 20MHz는 신호가 단단해서 멀리까지 안정적으로 전달
- 라즈베리파이처럼 안테나가 작은 기기에 유리

**채널 고정**
```
기존: 자동
변경: 채널 6 또는 11 (고정)
```

**이유**:
- 자동 채널 변경 시 연결이 끊기는 순간 발생
- 고정 채널로 설정하면 안정적 연결 유지

**암호화 방식**
```
WPA2PSK + AES (권장)
```

#### 5GHz 설정 (백홀 고속도로)

**5GHz 활성화 권장**
- Mesh 환경에서 공유기와 Extender 간 통신용
- 2.4GHz는 라즈베리파이 등 IoT 기기용으로 사용
- 5GHz를 켜면 Extender의 5G LED 깜빡임 해결

**설정 위치**
- [무선 설정/보안] > [5GHz 무선 설정]
- [네트워크 사용] 활성화
- SSID와 비밀번호는 2.4GHz와 동일하게 설정 권장

---

## 🔴 라즈베리파이 연결 문제 해결

### 1. 네트워크 연결 끊김 문제

#### 증상
- 공유기 목록에는 라즈베리파이(192.168.0.11)가 보임
- 하지만 `ping` 명령어가 실패하거나 시간 초과
- SSH 접속이 불가능

#### 원인 분석
1. **DHCP 임대 시간**: 공유기가 IP를 빌려주면 2시간 동안 목록에 남음 (Ghost IP)
2. **와이파이 비밀번호 변경**: 공유기 초기화 후 비밀번호가 바뀌어 라즈베리파이가 접속 실패
3. **보안 방식 불일치**: WPA2/WPA3 혼용 모드에서 라즈베리파이 호환성 문제

### 2. 해결 방법: SD 카드 설정 파일 수정

#### wpa_supplicant.conf 파일 생성

**파일 위치**: SD 카드 최상위 폴더 (boot 드라이브)

**파일 내용**:
```
country=KR
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1

network={
    ssid="와이파이_이름"
    psk="와이파이_비밀번호"
    key_mgmt=WPA-PSK
}
```

**주의사항**:
- 파일 이름: `wpa_supplicant.conf` (확장자 없음)
- 파일 형식: 모든 파일 (메모장에서 저장 시 `.txt`가 붙지 않도록 주의)
- SSID와 비밀번호는 대소문자 정확히 입력

#### ssh 파일 생성 (SSH 접속 활성화)

**파일 위치**: SD 카드 최상위 폴더

**파일 내용**: 없음 (빈 파일)

**파일 이름**: `ssh` (확장자 없음)

**효과**: 라즈베리파이 부팅 시 SSH 서버가 자동으로 활성화됨

### 3. 네트워크 연결 확인

#### 부팅 후 확인 순서
1. SD 카드를 라즈베리파이에 꽂고 전원 켜기
2. 2~3분 대기 (부팅 및 와이파이 연결 시간)
3. PC에서 `ping 192.168.0.11 -t` 실행
4. 응답이 오기 시작하면 연결 성공

#### 정상 연결 시 증상
```
Reply from 192.168.0.11: bytes=32 time=10ms TTL=64
Reply from 192.168.0.11: bytes=32 time=15ms TTL=64
```

#### 비정상 연결 시 증상
```
Request timed out.
Reply from 192.168.0.10: Destination host unreachable.
```

### 4. SSH 접속 문제 해결

#### 증상: Connection timed out
- `ping`은 되는데 SSH 접속이 안 됨
- Cursor(VS Code)에서 타임아웃 에러

#### 원인
1. **시간 동기화 실패**: 라즈베리파이 시간이 1970년으로 설정됨
2. **SSL 인증서 오류**: 시간이 안 맞아서 보안 연결 실패
3. **SSH 서버 미활성화**: ssh 파일이 없거나 설정 오류

#### 해결 방법

**1) 시간 수동 설정**
```bash
# SSH 접속 후
sudo date -s "2026-01-03 09:45:00"
```

**2) 시간 자동 동기화 확인**
```bash
timedatectl
# 확인 사항:
# - NTP service: active
# - System clock synchronized: yes
```

**3) 시간 동기화 재시작**
```bash
sudo systemctl restart systemd-timesyncd
```

**4) SSH 설정 파일 최적화**

`~/.ssh/config` 파일에 다음 내용 추가:
```
Host smartfarm
    HostName 192.168.0.11
    User pi
    Port 22
    ConnectTimeout 60
    ServerAliveInterval 15
    ServerAliveCountMax 3
```

**효과**:
- 연결이 끊겨도 60초 동안 재시도
- 15초마다 생존 확인 신호 전송
- 3번 실패할 때까지 연결 유지

---

## 🛠️ 네트워크 최적화 팁

### 1. IP 주소 고정 (DHCP 예약)

#### 목적
- 라즈베리파이 IP가 바뀌지 않도록 고정
- SSH 접속 설정 유지

#### 설정 방법
```
공유기 관리자 페이지 > [고급 설정] > [네트워크 관리] > [DHCP 서버 설정]
[사용 중인 IP 주소 정보] 목록에서 라즈베리파이 선택
[등록] 버튼 클릭
```

#### 효과
- 공유기 재부팅 후에도 동일한 IP 유지
- SSH config 파일 수정 불필요

### 2. Extender 위치 최적화

#### 이상적인 위치
- 메인 공유기와 라즈베리파이의 중간 지점
- 벽이나 장애물이 적은 곳
- 전원 공급이 안정적인 곳

#### LED 상태로 위치 판단
- **파란색**: 위치 완벽 (속도 빠름)
- **보라색/주황색**: 신호 약함 (속도 보통, 위치 조정 고려)
- **빨간색**: 연결 끊김 (위치 이동 필수)

### 3. 네트워크 손실 최소화

#### 문제 증상
- `ping` 시간이 1000ms 이상 튐
- SSH 접속 중 Connection reset 발생
- 데이터 전송 중 끊김

#### 해결책
1. **채널 크기 20MHz로 변경** (가장 중요)
2. **Easy Mesh 구성** (자동 로밍)
3. **5GHz 백홀 활성화** (공유기-Extender 간 고속 통신)
4. **Extender 위치 조정** (신호 강도 최적화)

---

## 📊 네트워크 구성도

### 최종 구성
```
[인터넷]
    ↓
[KT 모뎀] (신발장)
    ↓ (WAN)
[ipTIME Ring Mini 2] (Controller)
    ├─ [2.4GHz] ─→ [라즈베리파이] (베란다)
    ├─ [2.4GHz] ─→ [로봇청소기, 정수기 등]
    └─ [5GHz 백홀] ─→ [ipTIME Extender Giga] (Agent)
                          └─ [2.4GHz] ─→ [라즈베리파이] (신호 부스팅)
```

### IP 주소 체계
```
192.168.0.253  - 메인 공유기 (Ring Mini 2)
192.168.0.254  - Extender (초기값, Mesh 구성 후 변경 가능)
192.168.0.11   - 라즈베리파이 (고정 권장)
192.168.0.10   - PC/노트북
192.168.0.2~9  - 기타 IoT 기기
```

---

## 🎯 핵심 교훈

### 1. 공유기 초기화 후 필수 확인 사항
- [ ] DHCP 서버가 [실행] 상태인지 확인
- [ ] WAN 포트 모드로 설정되어 있는지 확인
- [ ] 와이파이 비밀번호 재설정
- [ ] 시간이 정상적으로 표시되는지 확인 (1970년이 아닌지)

### 2. 라즈베리파이 네트워크 문제 해결 순서
1. 공유기 목록에서 IP 확인
2. `ping` 테스트로 연결 상태 확인
3. 연결 안 되면 SD 카드 `wpa_supplicant.conf` 확인
4. SSH 접속 안 되면 `ssh` 파일 및 시간 동기화 확인

### 3. Mesh 구성 시 주의사항
- 초기 등록 시 Extender를 공유기 옆으로 가져오기
- 등록 완료 후 원래 위치로 이동 가능
- 5GHz를 켜면 백홀 고속도로 구축
- 2.4GHz는 20MHz로 설정하여 안정성 확보

### 4. 네트워크 최적화 원칙
- **안정성 > 속도**: IoT 기기는 20MHz가 40MHz보다 안정적
- **고정 > 자동**: 채널 고정으로 끊김 방지
- **분리 > 통합**: 2.4GHz(IoT)와 5GHz(백홀) 역할 분리

---

## 📝 참고 사항

### 공인 IP vs 사설 IP
- **공인 IP** (예: 112.181.243.2, 220.120.29.1): 인터넷에서 직접 접근 가능, 보안 위험
- **사설 IP** (예: 192.168.0.11): 공유기 내부에서만 사용, 안전

### DHCP 임대 시간
- 기본값: 7200초 (2시간)
- 기기가 연결을 끊어도 2시간 동안 목록에 남음 (Ghost IP)
- 실제 연결 상태는 `ping` 테스트로 확인

### 포트포워딩 (향후 작업)
- 외부에서 웹 대시보드 접속을 위한 포트포워딩 설정 필요
- 공유기 관리자 페이지 > [NAT/라우터 관리] > [포트포워드 설정]
- 내부 IP: 192.168.0.11 (라즈베리파이)
- 외부 포트: 5000 (또는 원하는 포트)
- 내부 포트: 5000

---

## ✅ 완료된 작업

- [x] 공유기 관리자 페이지 접속 문제 해결
- [x] DHCP 서버 활성화
- [x] WAN 포트 모드 설정
- [x] Easy Mesh 구성 (Controller + Agent)
- [x] 2.4GHz 무선 네트워크 최적화 (20MHz, 채널 고정)
- [x] 5GHz 백홀 활성화
- [x] 라즈베리파이 와이파이 재연결 (wpa_supplicant.conf)
- [x] SSH 접속 활성화 (ssh 파일)
- [x] 시간 동기화 확인 및 수정
- [x] SSH 설정 최적화 (타임아웃, 생존 신호)
- [x] 네트워크 연결 안정화

---

**작성 완료일**: 2026-01-03  
**다음 작업**: 포트포워딩 설정을 통한 외부 접속 활성화

